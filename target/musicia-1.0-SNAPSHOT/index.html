<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musicia - Home</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ====== Enhanced Now Playing Display ====== */
        .now-playing-container {
            background: linear-gradient(135deg, #1db954 0%, #1aa34a 100%);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(29, 185, 84, 0.3);
            text-align: center;
        }

        .now-playing-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .now-playing-title {
            font-size: 24px;
            font-weight: bold;
            color: #ffffff;
            margin: 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .now-playing-status {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
            font-style: italic;
        }

        /* ====== Custom Full-Width Spotify-Style Seeker ====== */
        .audio-player {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #121212;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .player-now-playing {
            font-size: 14px;
            color: #ccc;
            text-align: center;
        }

        .custom-seeker-container {
            display: flex;
            align-items: center;
            width: 100%;
            gap: 10px;
        }

        .seeker-bar {
            position: relative;
            flex: 1;
            height: 6px;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
        }

        .seeker-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 6px;
            width: 0%;
            background: #1db954;
            border-radius: 5px;
            transition: width 0.1s linear;
        }

        #current-time, #duration {
            font-size: 12px;
            color: #ccc;
            width: 40px;
            text-align: center;
        }

        /* ====== Control Buttons ====== */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 6px;
        }

        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            transition: transform 0.2s ease, color 0.2s ease;
        }

        .control-btn svg {
            width: 28px;
            height: 28px;
            fill: #fff;
        }

        .control-btn:hover svg {
            fill: #1db954;
            transform: scale(1.1);
        }

        .control-btn:active svg {
            transform: scale(0.95);
        }

        /* Responsive design for now playing */
        @media (max-width: 768px) {
            .now-playing-container {
                padding: 12px 15px;
                margin-bottom: 15px;
            }

            .now-playing-title {
                font-size: 18px;
            }

            .now-playing-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- ===== Navbar ===== -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">Musicia</a>
        <div class="nav-links">
            <a href="upload.html" class="upload-link" style="display: none;">Upload</a>
            <a href="login.html" class="login-link" style="display:none;">Login</a>
            <a href="register.html" class="register-link" style="display:none;">Register</a>
            <a href="#" class="logout-link" style="display:none;" onclick="auth.logout()">Logout</a>
        </div>
    </nav>

    <!-- ===== Main Container ===== -->
    <div class="container">
        <h1>Welcome to Musicia</h1>

        <div class="song-grid"></div>
    </div>

    <!-- ===== Custom Audio Player ===== -->
    <div class="audio-player">
        <div class="player-now-playing" id="player-status">Nothing playing...</div>
        <audio id="audio-player"></audio>

        <div class="custom-seeker-container">
            <div id="current-time">0:00</div>
            <div class="seeker-bar">
                <div class="seeker-progress"></div>
            </div>
            <div id="duration">0:00</div>
        </div>

        <div class="controls">
            <!-- Play button -->
            <button id="play-btn" class="control-btn">
                <svg viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
            </button>

            <!-- Pause button -->
            <button id="pause-btn" class="control-btn" style="display:none;">
                <svg viewBox="0 0 24 24">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- ===== Scripts ===== -->
    <script src="js/auth.js"></script>
    <script src="js/player.js"></script>

    <script>
        // ===== Navbar Auth Control =====
        document.addEventListener('DOMContentLoaded', () => {
            const raw = localStorage.getItem('user');
            const user = raw ? JSON.parse(raw) : null;

            if (user) {
                document.querySelector('.login-link').style.display = 'none';
                document.querySelector('.register-link').style.display = 'none';
                document.querySelector('.logout-link').style.display = 'inline';
                if (user.isArtist) {
                    document.querySelector('.upload-link').style.display = 'inline';
                }
            } else {
                document.querySelector('.login-link').style.display = 'inline';
                document.querySelector('.register-link').style.display = 'inline';
                document.querySelector('.logout-link').style.display = 'none';
                document.querySelector('.upload-link').style.display = 'none';
            }
        });

        // ===== Spotify-like Player Logic =====
        const audio = document.getElementById('audio-player');
        const seekerBar = document.querySelector('.seeker-bar');
        const seekerProgress = document.querySelector('.seeker-progress');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const playerStatus = document.getElementById('player-status');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');

        // Now playing display elements
        const nowPlayingSection = document.getElementById('now-playing-section');
        const nowPlayingTitle = document.getElementById('now-playing-song-title');
        const nowPlayingStatus = document.getElementById('now-playing-status');

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m}:${s < 10 ? '0' + s : s}`;
        }

        audio.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audio.duration);
        });

        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                const progress = (audio.currentTime / audio.duration) * 100;
                seekerProgress.style.width = progress + '%';
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
        });

        seekerBar.addEventListener('click', (e) => {
            const rect = seekerBar.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const newTime = (clickX / rect.width) * audio.duration;
            audio.currentTime = newTime;
        });

        playBtn.addEventListener('click', () => {
            audio.play();
        });

        pauseBtn.addEventListener('click', () => {
            audio.pause();
        });

        // Auto-sync when songs play via external clicks
        audio.addEventListener('play', () => {
            playBtn.style.display = 'none';
            pauseBtn.style.display = 'inline';
            if (player.currentSong) {
                playerStatus.textContent = `▶ ${player.currentSong.title}`;
            }
            nowPlayingStatus.textContent = '▶ playing';
            nowPlayingSection.style.display = 'block';
        });

        audio.addEventListener('pause', () => {
            playBtn.style.display = 'inline';
            pauseBtn.style.display = 'none';
            if (player.currentSong) {
                playerStatus.textContent = `⏸ ${player.currentSong.title}`;
            }
            nowPlayingStatus.textContent = '⏸ paused';
        });

        audio.addEventListener('ended', () => {
            playBtn.style.display = 'inline';
            pauseBtn.style.display = 'none';
            seekerProgress.style.width = '0%';
            currentTimeEl.textContent = '0:00';
            playerStatus.textContent = 'Nothing playing...';
            nowPlayingStatus.textContent = 'finished';
            nowPlayingSection.style.display = 'none';
        });

        // Update now playing display when song changes
        const originalPlaySong = player.playSong;
        player.playSong = function(songId) {
            originalPlaySong(songId);
            const song = player.currentSong;
            if (song) {
                playerStatus.textContent = `▶ ${song.title}`;
                nowPlayingTitle.textContent = song.title;
                nowPlayingStatus.textContent = '▶ playing';
                nowPlayingSection.style.display = 'block';
            }
        };
    </script>
</body>
</html>